<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé≤ DataLotto49</title>
<style>
:root{
--primary:#6366f1;
--primary-dark:#4f46e5;
--secondary:#8b5cf6;
--success:#10b981;
--danger:#ef4444;
--danger-light:#fca5a5;
--warning:#f59e0b;
--info:#06b6d4;
--dark:#1f2937;
--light:#f9fafb;
--gray:#6b7280;
--border-radius: 12px;
--shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
--transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

*{
margin: 0;
padding: 0;
box-sizing: border-box;
}

body{
font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);
min-height: 100vh;
padding: 20px;
color: var(--dark);
}

.container{
max-width: 1400px;
margin: 0 auto;
}

.header{
text-align: center;
margin-bottom: 30px;
padding: 20px;
background: white;
border-radius: var(--border-radius);
box-shadow: var(--shadow);
}

.header h1{
color: var(--primary);
font-size: 2.5rem;
margin-bottom: 10px;
display: flex;
align-items: center;
justify-content: center;
gap: 10px;
}

.header p{
color: var(--gray);
font-size: 1.1rem;
}

.main-grid{
display: grid;
grid-template-columns: 2fr 1fr;
gap: 20px;
margin-bottom: 20px;
}

@media(max-width: 992px){
.main-grid{
grid-template-columns: 1fr;
}
}

.game-section{
display: flex;
flex-direction: column;
gap: 20px;
}

.selected-numbers{
background: white;
padding: 20px;
border-radius: var(--border-radius);
box-shadow: var(--shadow);
}

.selected-numbers h3{
color: var(--primary);
margin-bottom: 15px;
display: flex;
align-items: center;
gap: 10px;
}

.selected-display{
min-height: 60px;
border: 2px dashed #e5e7eb;
border-radius: 8px;
padding: 15px;
display: flex;
flex-wrap: wrap;
gap: 10px;
align-items: center;
justify-content: center;
}

.number-selection-section{
background: white;
padding: 20px;
border-radius: var(--border-radius);
box-shadow: var(--shadow);
}

.number-selection-header{
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
}

.number-selection-header h3{
color: var(--primary);
}

.selection-mode-controls{
display: flex;
gap: 10px;
}

.selection-mode-btn{
width: 40px;
height: 40px;
border: 2px solid #e5e7eb;
background: white;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.4s ease, border-color 0.3s;
}

.selection-mode-btn:hover{
border-color: var(--primary);
transform: translateY(-2px);
}

.selection-mode-btn.active{
border-color: var(--primary);
background: var(--primary);
color: white;
}

#randomBtn:hover {
    transform: rotate(360deg);
}

#clearBtn {
    transition: all 0.3s ease;
}

#clearBtn:hover {
    transform: scale(1.1);
}

#clearBtn.has-selections {
    background: var(--danger-light);
    border-color: var(--danger-light);
    color: white;
}

/* Nueva matriz 10x5 */
.numbers-grid{
display: grid;
grid-template-columns: repeat(10, 1fr);
grid-template-rows: repeat(5, 1fr);
gap: 8px;
max-width: 500px;
margin: 0 auto;
}

@media(max-width: 768px){
.numbers-grid{
grid-template-columns: repeat(10, 1fr);
gap: 6px;
}
}

.number-ball{
width: 100%;
aspect-ratio: 1;
background:#f3f4f6;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-weight: bold;
cursor: pointer;
transition: var(--transition);
border: 2px solid transparent;
font-size: 0.9rem;
}

.number-ball:hover{
transform: scale(1.1);
border-color: var(--primary);
}

.number-ball.selected{
background: var(--primary);
color: white;
transform: scale(1.1);
}

.number-ball.cold{
background:#3b82f6;
color: white;
}

.number-ball.hot{
background:#ef4444;
color: white;
}

.number-ball.excluded{
background:#6b7280;
color: white;
opacity: 0.7;
}

.number-ball.random-pick {
    background: var(--warning);
    color: white;
    transform: scale(1.1);
    border-color: var(--warning);
}

.stats-section{
background: white;
padding: 20px;
border-radius: var(--border-radius);
box-shadow: var(--shadow);
}

.stats-section h3{
color: var(--primary);
margin-bottom: 15px;
display: flex;
align-items: center;
gap: 10px;
}

.stats-grid{
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 15px;
}

@media(max-width: 576px){
.stats-grid{
grid-template-columns: 1fr;
}
}

.stat-item{
padding: 12px;
background:#f9fafb;
border-radius: 8px;
border-left: 4px solid var(--primary);
}

.stat-label{
font-size: 0.9rem;
color: var(--gray);
margin-bottom: 5px;
}

.stat-value{
font-weight: bold;
color: var(--dark);
}

.stat-value.valid{
color: var(--success);
}

.stat-value.invalid{
color: var(--danger);
}

.sidebar{
display: flex;
flex-direction: column;
gap: 20px;
}

.panel{
background: white;
padding: 20px;
border-radius: var(--border-radius);
box-shadow: var(--shadow);
}

.panel h3{
color: var(--primary);
margin-bottom: 20px;
display: flex;
align-items: center;
gap: 10px;
}

.strategy-buttons{
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 10px;
margin-bottom: 20px;
}

.strategy-btn{
padding: 15px 10px;
background:#f3f4f6;
border-radius: 8px;
text-align: center;
cursor: pointer;
transition: var(--transition);
border: 2px solid transparent;
}

.strategy-btn:hover{
transform: translateY(-2px);
border-color: var(--primary);
}

.strategy-btn.active{
background: var(--primary);
color: white;
border-color: var(--primary);
}

.input-row{
display: flex;
align-items: center;
gap: 10px;
margin-bottom: 15px;
}

.input-row label{
font-weight: bold;
color: var(--dark);
min-width: 60px;
}

.input-row input{
width: 80px;
padding: 8px 12px;
border: 2px solid #e5e7eb;
border-radius: 6px;
font-size: 1rem;
}

.input-row input:focus{
outline: none;
border-color: var(--primary);
}

.input-row span{
color: var(--gray);
}

.number-option{
padding: 10px;
background:#f3f4f6;
border-radius: 6px;
text-align: center;
cursor: pointer;
transition: var(--transition);
}

.number-option:hover{
background: var(--primary);
color: white;
}

.number-option.active{
background: var(--primary);
color: white;
}

.generate-btn{
width: 100%;
padding: 15px;
background: linear-gradient(135deg, var(--primary), var(--secondary));
color: white;
border: none;
border-radius: 8px;
font-size: 1.1rem;
font-weight: bold;
cursor: pointer;
transition: var(--transition);
margin: 20px 0;
display: flex;
align-items: center;
justify-content: center;
gap: 10px;
}

.generate-btn:hover{
transform: translateY(-2px);
box-shadow: var(--shadow-lg);
}

.ticket{
background:#f3f4f6;
border-radius: 8px;
padding: 15px;
margin-top: 20px;
display: none;
}

.ticket-header{
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
padding-bottom: 10px;
border-bottom: 2px solid #e5e7eb;
}

.ticket-header h4{
color: var(--primary);
font-size: 1.1rem;
}

.ticket-header p{
color: var(--gray);
font-size: 0.9rem;
}

.ticket-combination{
display: flex;
align-items: center;
gap: 10px;
padding: 10px;
background: white;
border-radius: 6px;
margin-bottom: 8px;
}

.ticket-number{
width: 25px;
height: 25px;
background: var(--primary);
color: white;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 0.8rem;
font-weight: bold;
flex-shrink: 0;
}

.ticket-actions{
display: flex;
gap: 10px;
margin-top: 15px;
}

.ticket-btn{
flex: 1;
padding: 10px;
border: none;
border-radius: 6px;
cursor: pointer;
font-weight: bold;
display: flex;
align-items: center;
justify-content: center;
gap: 5px;
transition: var(--transition);
}

.ticket-btn:disabled {
    background: var(--gray);
    cursor: not-allowed;
    opacity: 0.6;
}

.save-btn{
background: var(--success);
color: white;
}

.share-btn{
background: var(--info);
color: white;
}

.ticket-btn:hover:not(:disabled){
transform: translateY(-2px);
}

.filters-panel{
display: flex;
flex-direction: column;
gap: 15px;
}

.filter-group{
padding: 15px;
background:#f9fafb;
border-radius: 8px;
border-left: 4px solid var(--primary);
}

.filter-title{
font-weight: bold;
color: var(--dark);
margin-bottom: 10px;
font-size: 0.95rem;
}

.range-control{
display: flex;
align-items: center;
gap: 10px;
}

.range-control input{
width: 80px;
padding: 8px 12px;
border: 2px solid #e5e7eb;
border-radius: 6px;
font-size: 1rem;
}

.range-control input:focus{
outline: none;
border-color: var(--primary);
}

.range-control span{
color: var(--gray);
}

.filter-options{
display: flex;
flex-wrap: wrap;
gap: 8px;
margin-top: 10px;
}

.filter-chip{
padding: 6px 12px;
background:#f3f4f6;
border-radius: 20px;
font-size: 0.85rem;
cursor: pointer;
transition: var(--transition);
border: 2px solid transparent;
}

.filter-chip:hover{
border-color: var(--primary);
}

.filter-chip.active{
background: var(--primary);
color: white;
border-color: var(--primary);
}

.saved-tickets-section{
background: white;
padding: 20px;
border-radius: var(--border-radius);
box-shadow: var(--shadow);
}

.saved-tickets-section h3{
color: var(--primary);
margin-bottom: 20px;
display: flex;
align-items: center;
gap: 10px;
}

.saved-tickets{
display: flex;
flex-direction: column;
gap: 15px;
}

.saved-ticket-item{
border: 2px solid #e5e7eb;
border-radius: 8px;
padding: 15px;
}

.saved-ticket-header{
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
}

.saved-ticket-date{
font-weight: bold;
color: var(--dark);
font-size: 0.95rem;
}

.saved-ticket-actions{
display: flex;
gap: 10px;
}

.validate{
background: var(--success);
color: white;
border: none;
padding: 6px 12px;
border-radius: 6px;
cursor: pointer;
font-size: 0.85rem;
}

.toggle-btn{
background: var(--primary);
color: white;
border: none;
width: 30px;
height: 30px;
border-radius: 50%;
cursor: pointer;
font-size: 1.2rem;
display: flex;
align-items: center;
justify-content: center;
}

.saved-combinations{
margin-top: 10px;
padding: 10px;
background:#f9fafb;
border-radius: 6px;
display: none;
}

.saved-combination{
display: flex;
align-items: center;
justify-content: space-between;
gap: 10px;
padding: 8px;
background: white;
border-radius: 4px;
margin-bottom: 5px;
}

.hit-count {
    font-size: 0.85rem;
    font-weight: bold;
    color: var(--success);
    background-color: #e8f9f1;
    padding: 3px 8px;
    border-radius: 10px;
}

.saved-combination-number{
width: 20px;
height: 20px;
background: var(--primary);
color: white;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 0.7rem;
font-weight: bold;
flex-shrink: 0;
}

.saved-combination-content {
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Animation */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.number-ball.selected {
  animation: pulse 0.3s ease-in-out;
}

.generate-btn {
  animation: pulse 0.6s infinite alternate;
}

/* Loading */
.loading {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.loading-content {
  background: white;
  padding: 30px;
  border-radius: 15px;
  text-align: center;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 5px solid #f3f4f6;
  border-top: 5px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Modal con scroll */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.modal-content {
  background: white;
  padding: 30px;
  border-radius: 15px;
  width: 90%;
  max-width: 500px;
  max-height: 80vh;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  display: flex;
  flex-direction: column;
}

.modal-header {
  margin-bottom: 20px;
  flex-shrink: 0;
}

.modal-header h3 {
  color: var(--primary);
  margin-bottom: 10px;
}

.modal-input {
  width: 100%;
  padding: 12px;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  font-size: 1rem;
  margin-bottom: 20px;
  flex-shrink: 0;
}

.modal-input:focus {
  outline: none;
  border-color: var(--primary);
}

#validationResults {
  flex: 1;
  overflow-y: auto;
  max-height: 300px;
  margin-bottom: 20px;
  padding-right: 10px;
}

#validationResults::-webkit-scrollbar {
  width: 8px;
}

#validationResults::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 4px;
}

#validationResults::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 4px;
}

#validationResults::-webkit-scrollbar-thumb:hover {
  background: var(--primary-dark);
}

.modal-actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  flex-shrink: 0;
}

.modal-btn {
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}

.modal-btn.cancel {
  background: #f3f4f6;
  color: var(--dark);
}

.modal-btn.confirm {
  background: var(--success);
  color: white;
}

/* Toast */
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 15px 20px;
  border-radius: 8px;
  color: white;
  font-weight: bold;
  z-index: 1000;
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.3s ease;
}

.toast.show {
  opacity: 1;
  transform: translateY(0);
}

.toast.success {
  background: var(--success);
}

.toast.error {
  background: var(--danger);
}

.toast.warning {
  background: var(--warning);
}
</style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>üé≤ DataLotto49</h1>
      <p>Generador Inteligente de Combinaciones Ganadoras</p>
    </header>

    <div class="main-grid">
      <div class="game-section">
        <div class="selected-numbers">
          <h3>üéØ N√∫meros Seleccionados</h3>
          <div class="selected-display" id="selectedDisplay">
            <div style="color:#666; font-style: italic;">Selecciona hasta 6 n√∫meros</div>
          </div>
        </div>

        <div class="number-selection-section">
          <div class="number-selection-header">
            <h3>Selecci√≥n de n√∫meros</h3>
            <div class="selection-mode-controls">
              <button class="selection-mode-btn active" data-mode="cold" title="Marcar/Desmarcar n√∫meros fr√≠os">
                <span class="icon">‚ùÑ</span>
              </button>
              <button class="selection-mode-btn" data-mode="hot" title="Marcar/Desmarcar n√∫meros calientes">
                <span class="icon">üî•</span>
              </button>
              <button class="selection-mode-btn" data-mode="excluded" title="Marcar/Desmarcar n√∫meros excluidos">
                <span class="icon">üö´</span>
              </button>
              <button class="selection-mode-btn" id="randomBtn" title="Seleccionar 6 n√∫meros al azar">
                <span class="icon">üé≤</span>
              </button>
              <button class="selection-mode-btn" id="clearBtn" title="Limpiar todas las selecciones">
                <span class="icon">üóëÔ∏è</span>
              </button>
            </div>
          </div>

          <div class="numbers-grid" id="numbersGrid">
            <!-- Matriz 10x5: Los n√∫meros se generan din√°micamente -->
          </div>
        </div>

        <div class="stats-section">
          <h3>üìä Estad√≠sticas en Tiempo Real</h3>
          <div class="stats-grid" id="statsGrid">
            <div class="stat-item">
              <div class="stat-label">Suma Total</div>
              <div class="stat-value" id="statSuma">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Par/Impar</div>
              <div class="stat-value" id="statParImpar">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Bajos/Altos</div>
              <div class="stat-value" id="statBajosAltos">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Decenas</div>
              <div class="stat-value" id="statDecenas">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Agrup. Decenas</div>
              <div class="stat-value" id="statAgrupDecenas">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Consecutivos</div>
              <div class="stat-value" id="statConsecutivos">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Suma D√≠gitos</div>
              <div class="stat-value" id="statSumaDigitos">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">N√∫meros Primos</div>
              <div class="stat-value" id="statPrimos">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Desviaci√≥n</div>
              <div class="stat-value" id="statDesviacion">-</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Patrones</div>
              <div class="stat-value" id="statPatrones">-</div>
            </div>
          </div>
        </div>
      </div>

      <div class="sidebar">
        <div class="panel">
          <h3>‚ôü Estrategia de Juego</h3>
          <div class="strategy-buttons">
            <div class="strategy-btn active" data-strategy="simple">
              <div style="font-size: 1.5rem; margin-bottom: 5px;">üéØ</div>
              <div>Simple</div>
            </div>
            <div class="strategy-btn" data-strategy="winning">
              <div style="font-size: 1.5rem; margin-bottom: 5px;">üèÜ</div>
              <div>Estrategia Ganadora</div>
            </div>
            <div class="strategy-btn" data-strategy="multiple">
              <div style="font-size: 1.5rem; margin-bottom: 5px;">üé∞</div>
              <div>M√∫ltiple</div>
            </div>
          </div>

          <div class="multiple-options" id="winningOptions" style="display: none;">
            <div class="input-row">
              <label>Generar:</label>
              <input type="number" id="generateCount" value="100" min="10" max="1000">
              <span>combinaciones</span>
            </div>
            <div class="input-row">
              <label>Jugar:</label>
              <input type="number" id="playCount" value="10" min="1" max="100">
              <span>mejores</span>
            </div>
          </div>

          <div class="multiple-numbers-options" id="multipleNumbersOptions" style="display: none;">
            <div class="numbers-select">
              <label>¬øCu√°ntos n√∫meros quieres seleccionar?</label>
              <div class="number-option active" data-numbers="7">7 n√∫meros</div>
              <div class="number-option" data-numbers="8">8 n√∫meros</div>
              <div class="number-option" data-numbers="9">9 n√∫meros</div>
              <div class="number-option" data-numbers="10">10 n√∫meros</div>
              <div class="number-option" data-numbers="11">11 n√∫meros</div>
            </div>
          </div>

          <button class="generate-btn" id="generateBtn">üçÄ Generar Combinaci√≥n</button>

          <div class="ticket" id="ticket">
            <div class="ticket-header">
              <h4>üé´ Tu Boleto Ganador</h4>
              <p id="ticketDate"></p>
            </div>
            <div id="ticketCombinations"></div>
            <div class="ticket-actions">
              <button class="ticket-btn save-btn" id="saveBtn">üíæ Guardar Boleto</button>
              <button class="ticket-btn share-btn" id="shareBtn">üì§ Compartir</button>
            </div>
          </div>
        </div>

        <div class="panel">
          <h3>‚öô Filtros Inteligentes</h3>
          <div class="filters-panel">
            <div class="filter-group">
              <div class="filter-title">üéØ Suma Total</div>
              <div class="range-control">
                <input type="number" id="sumMin" value="140" min="21" max="279">
                <span>a</span>
                <input type="number" id="sumMax" value="169" min="21" max="279">
              </div>
            </div>

            <div class="filter-group">
              <div class="filter-title">‚öñ Par/Impar</div>
              <div class="filter-options" id="parImparOptions">
                <div class="filter-chip" data-value="6/0">6/0</div>
                <div class="filter-chip" data-value="5/1">5/1</div>
                <div class="filter-chip active" data-value="4/2">4/2</div>
                <div class="filter-chip active" data-value="3/3">3/3</div>
                <div class="filter-chip active" data-value="2/4">2/4</div>
                <div class="filter-chip" data-value="1/5">1/5</div>
                <div class="filter-chip" data-value="0/6">0/6</div>
              </div>
            </div>

            <div class="filter-group">
              <div class="filter-title">üìä Bajos/Altos(1-25/26-49)</div>
              <div class="filter-options" id="bajosAltosOptions">
                <div class="filter-chip" data-value="6/0">6/0</div>
                <div class="filter-chip" data-value="5/1">5/1</div>
                <div class="filter-chip active" data-value="4/2">4/2</div>
                <div class="filter-chip active" data-value="3/3">3/3</div>
                <div class="filter-chip active" data-value="2/4">2/4</div>
                <div class="filter-chip" data-value="1/5">1/5</div>
                <div class="filter-chip" data-value="0/6">0/6</div>
              </div>
            </div>

            <div class="filter-group">
              <div class="filter-title">üî¢ Agrupaci√≥n por Decenas</div>
              <div class="filter-options" id="agrupDecenasOptions">
                <div class="filter-chip active" data-value="6">6</div>
                <div class="filter-chip active" data-value="5/1">5/1</div>
                <div class="filter-chip active" data-value="4/2">4/2</div>
                <div class="filter-chip active" data-value="4/1/1">4/1/1</div>
                <div class="filter-chip active" data-value="3/3">3/3</div>
                <div class="filter-chip active" data-value="3/2/1">3/2/1</div>
                <div class="filter-chip active" data-value="3/1/1/1">3/1/1/1</div>
                <div class="filter-chip active" data-value="2/2/2">2/2/2</div>
                <div class="filter-chip active" data-value="2/2/1/1">2/2/1/1</div>
                <div class="filter-chip active" data-value="2/1/1/1/1">2/1/1/1/1</div>
              </div>
            </div>

            <div class="filter-group">
              <div class="filter-title">üîó N√∫meros Consecutivos</div>
              <div class="filter-options" id="consecutivosOptions">
                <div class="filter-chip active" data-value="6">6</div>
                <div class="filter-chip active" data-value="5/1">5/1</div>
                <div class="filter-chip active" data-value="4/2">4/2</div>
                <div class="filter-chip active" data-value="4/1/1">4/1/1</div>
                <div class="filter-chip active" data-value="3/3">3/3</div>
                <div class="filter-chip active" data-value="3/2/1">3/2/1</div>
                <div class="filter-chip active" data-value="3/1/1/1">3/1/1/1</div>
                <div class="filter-chip active" data-value="2/2/2">2/2/2</div>
                <div class="filter-chip active" data-value="2/2/1/1">2/2/1/1</div>
                <div class="filter-chip active" data-value="2/1/1/1/1">2/1/1/1/1</div>
                <div class="filter-chip active" data-value="1/1/1/1/1/1">1/1/1/1/1/1</div>
              </div>
            </div>

            <div class="filter-group">
              <div class="filter-title">‚ùå Excluir Terminaciones</div>
              <div class="filter-options" id="terminacionesExcluidasOptions">
                <div class="filter-chip" data-value="0">*0</div>
                <div class="filter-chip" data-value="1">*1</div>
                <div class="filter-chip" data-value="2">*2</div>
                <div class="filter-chip" data-value="3">*3</div>
                <div class="filter-chip" data-value="4">*4</div>
                <div class="filter-chip" data-value="5">*5</div>
                <div class="filter-chip" data-value="6">*6</div>
                <div class="filter-chip" data-value="7">*7</div>
                <div class="filter-chip" data-value="8">*8</div>
                <div class="filter-chip" data-value="9">*9</div>
              </div>
            </div>

            <div class="filter-group">
              <div class="filter-title">‚àë Suma de D√≠gitos</div>
              <div class="range-control">
                <input type="number" id="sumaDigitosMin" value="28" min="21" max="63">
                <span>a</span>
                <input type="number" id="sumaDigitosMax" value="45" min="21" max="63">
              </div>
            </div>

            <div class="filter-group">
              <div class="filter-title">üî¢ N√∫meros Primos</div>
              <div class="range-control">
                <span>Entre</span>
                <input type="number" id="primosMin" value="2" min="0" max="6">
                <span>y</span>
                <input type="number" id="primosMax" value="3" min="0" max="6">
                <span>primos</span>
              </div>
            </div>

            <div class="filter-group">
              <div class="filter-title">üìä Desviaci√≥n Est√°ndar</div>
              <div class="range-control">
                <input type="number" id="desviacionMin" value="12.0" min="1" max="24" step="0.1">
                <span>a</span>
                <input type="number" id="desviacionMax" value="18.0" min="1" max="24" step="0.1">
              </div>
            </div>

            <div class="filter-group">
              <div class="filter-title">üö´ Excluir Patrones</div>
              <div class="filter-options" id="patronesOptions">
                <div class="filter-chip" data-value="fibonacci">‚ùå Fibonacci</div>
                <div class="filter-chip" data-value="paresConsecutivos">‚ùå Pares consecutivos</div>
                <div class="filter-chip" data-value="multiplos">‚ùå M√∫ltiplos</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Saved Tickets Section -->
    <div class="saved-tickets-section">
      <h3>üóÇ Boletos Guardados</h3>
      <div class="saved-tickets" id="savedTickets">
        <div style="color:#666; text-align: center; padding: 20px;">No tienes boletos guardados</div>
      </div>
    </div>

    <!-- Loading Modal -->
    <div class="loading" id="loadingModal">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <h3 id="loadingText">Generando combinaci√≥n...</h3>
        <p>Intentos: <span id="loadingAttempts">0</span></p>
      </div>
    </div>

    <!-- Validation Modal -->
    <div class="modal" id="validationModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>üîç Validar Boleto</h3>
          <p>Introduce los 6 n√∫meros ganadores separados por espacios, comas o puntos.</p>
        </div>
        <input type="text" class="modal-input" id="winningNumbersInput" placeholder="7, 12. 23 31,42.49" maxlength="23">
        <div id="validationResults"></div>
        <div class="modal-actions">
          <button class="modal-btn cancel" id="cancelValidationBtn">Cerrar</button>
          <button class="modal-btn confirm" id="confirmValidationBtn">Validar</button>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>
  </div>

  <script>
    class DataLotto49Advanced {
      constructor() {
        // Estado del sistema
        this.selectedNumbers = [];
        this.excludedNumbers = new Set();
        this.hotNumbers = new Set();
        this.coldNumbers = new Set();
        this.currentSelectionMode = 'cold';
        this.isGenerating = false;
        this.savedTickets = [];
        this.currentTicket = null;
        this.currentValidatingTicket = null;
        this.historicalData = [];
        this.numberStats = {};
        this.analysisPeriod = 100;
        this.hotThreshold = 1.5;
        this.coldThreshold = 0.5;

        // Filtros
        this.filters = {
          sum: { min: 140, max: 169 },
          parImpar: ['4/2', '3/3', '2/4'],
          bajosAltos: ['4/2', '3/3', '2/4'],
          agrupDecenas: ['6', '5/1', '4/2', '4/1/1', '3/3', '3/2/1', '3/1/1/1', '2/2/2', '2/2/1/1', '2/1/1/1/1'],
          consecutivos: ['6', '5/1', '4/2', '4/1/1', '3/3', '3/2/1', '3/1/1/1', '2/2/2', '2/2/1/1', '2/1/1/1/1', '1/1/1/1/1/1'],
          terminaciones: [],
          sumaDigitos: { min: 28, max: 45 },
          primos: { min: 2, max: 3 },
          desviacion: { min: 12.0, max: 18.0 },
          patrones: []
        };

        // Inicializar
        this.initializeHistoricalData();
        this.initializeNumberStats();
        this.analyzeNumbers();
        this.createNumbersGrid();
        this.loadSavedTickets();
        this.bindEvents();
        this.updateFilters();
      }

      // Crear matriz 10x5
      createNumbersGrid() {
        const grid = document.getElementById('numbersGrid');
        grid.innerHTML = '';
        
        // Matriz 10x5: Fila 1: 1-10, Fila 2: 11-20, Fila 3: 21-30, Fila 4: 31-40, Fila 5: 41-49
        for(let fila = 0; fila < 5; fila++) {
          for(let col = 0; col < 10; col++) {
            const numero = fila * 10 + col + 1;
            
            // √öltima fila solo hasta 49
            if(numero > 49) break;
            
            const ball = document.createElement('div');
            ball.className = 'number-ball';
            ball.dataset.number = numero;
            ball.innerHTML = `<span>${numero}</span>`;
            ball.addEventListener('click', () => this.handleNumberClick(numero, ball));
            grid.appendChild(ball);
          }
        }
      }

      // Inicializaci√≥n de datos hist√≥ricos
      initializeHistoricalData() {
        const baseDate = new Date();
        baseDate.setDate(baseDate.getDate() - 1000);

        for(let i = 0; i < 500; i++) {
          const drawDate = new Date(baseDate);
          drawDate.setDate(drawDate.getDate() + (i * 3.5));
          const numbers = this.generateRealisticDraw(i);
          this.historicalData.push({
            id: i + 1,
            date: drawDate,
            numbers: numbers.sort((a, b) => a - b),
            sum: numbers.reduce((a, b) => a + b, 0)
          });
        }
      }

      // Generaci√≥n de sorteos realistas
      generateRealisticDraw(drawIndex) {
        const numbers = new Set();
        const ranges = [
          { min: 1, max: 9, target: 1, weight: 0.8 },
          { min: 10, max: 19, target: 1, weight: 1.0 },
          { min: 20, max: 29, target: 1, weight: 1.0 },
          { min: 30, max: 39, target: 1, weight: 1.0 },
          { min: 40, max: 49, target: 1, weight: 0.8 }
        ];

        while(numbers.size < 6) {
          const totalWeight = ranges.reduce((sum, r) => sum + r.weight, 0);
          let rand = Math.random() * totalWeight;
          let selectedRange = null;

          for(const range of ranges) {
            rand -= range.weight;
            if(rand <= 0) {
              selectedRange = range;
              break;
            }
          }

          if(selectedRange) {
            let attempts = 0;
            while(attempts < 10) {
              const num = Math.floor(Math.random() * (selectedRange.max - selectedRange.min + 1)) + selectedRange.min;
              if(!numbers.has(num)) {
                numbers.add(num);
                break;
              }
              attempts++;
            }
          }
        }

        return Array.from(numbers);
      }

      // Inicializaci√≥n de estad√≠sticas de n√∫meros
      initializeNumberStats() {
        for(let i = 1; i <= 49; i++) {
          this.numberStats[i] = {
            frequency: 0,
            lastAppearance: -1,
            relativeFreq: 0,
            trend: 0,
            cycle: 0,
            score: 0
          };
        }
      }

      // An√°lisis de n√∫meros
      analyzeNumbers() {
        this.initializeNumberStats();

        const analysisData = this.historicalData.slice(-this.analysisPeriod);
        const totalDraws = analysisData.length;

        analysisData.forEach((draw, index) => {
          draw.numbers.forEach(num => {
            this.numberStats[num].frequency++;
            this.numberStats[num].lastAppearance = index;
          });
        });

        for(let num = 1; num <= 49; num++) {
          const stats = this.numberStats[num];
          stats.relativeFreq = (stats.frequency / totalDraws) * 100;

          const recentDraws = analysisData.slice(-20);
          const recentFrequency = recentDraws.filter(draw => draw.numbers.includes(num)).length;
          const olderDraws = analysisData.slice(-40, -20);
          const olderFrequency = olderDraws.filter(draw => draw.numbers.includes(num)).length;
          stats.trend = recentFrequency - olderFrequency;

          if(stats.lastAppearance === -1) {
            stats.cycle = totalDraws;
          } else {
            stats.cycle = totalDraws - 1 - stats.lastAppearance;
          }

          stats.score = this.calculateCompositeScore(num);
        }

        this.classifyNumbers();
      }

      // C√°lculo de puntuaci√≥n compuesta
      calculateCompositeScore(num) {
        const stats = this.numberStats[num];
        const avgFreq = this.analysisPeriod / 6;
        const freqComponent = (stats.frequency - avgFreq) / avgFreq;
        const trendComponent = Math.max(-1, Math.min(1, stats.trend));
        const maxCycle = this.analysisPeriod * 0.5;
        const cycleComponent = (maxCycle - stats.cycle) / maxCycle;

        return (freqComponent * 0.4) + (trendComponent * 0.3) + (cycleComponent * 0.3);
      }

      // Clasificaci√≥n de n√∫meros
      classifyNumbers() {
        this.hotNumbers.clear();
        this.coldNumbers.clear();

        for(let num = 1; num <= 49; num++) {
          const score = this.numberStats[num].score;
          if(score > this.hotThreshold) {
            this.hotNumbers.add(num);
          } else if(score < this.coldThreshold) {
            this.coldNumbers.add(num);
          }
        }
      }

      // Vinculaci√≥n de eventos
      bindEvents() {
        // Modo de selecci√≥n (SIN el bot√≥n de la mano)
        document.querySelectorAll('.selection-mode-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            // Botones especiales
            if (e.currentTarget.id === 'randomBtn') {
              this.selectRandomNumbers();
              return;
            }
            if (e.currentTarget.id === 'clearBtn') {
              this.clearAllSelections();
              return;
            }
            
            // Cambio de modo normal
            document.querySelectorAll('.selection-mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            this.currentSelectionMode = btn.dataset.mode;
          });
        });

        // Estrategia de juego
        document.querySelectorAll('.strategy-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('.strategy-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const strategy = btn.dataset.strategy;
            document.getElementById('winningOptions').style.display = strategy === 'winning' ? 'block' : 'none';
            document.getElementById('multipleNumbersOptions').style.display = strategy === 'multiple' ? 'block' : 'none';
          });
        });

        // Opciones de n√∫meros m√∫ltiples
        document.querySelectorAll('.number-option').forEach(option => {
          option.addEventListener('click', () => {
            document.querySelectorAll('.number-option').forEach(o => o.classList.remove('active'));
            option.classList.add('active');
          });
        });

        // Chips de filtros
        document.addEventListener('click', (e) => {
          if(e.target.classList.contains('filter-chip') && e.target.dataset.value) {
            this.handleFilterClick(e.target);
          }
        });

        // Inputs de rango
        const rangeInputsConfig = [
            { minId: 'sumMin', maxId: 'sumMax', absoluteMin: 21, absoluteMax: 279, prefix: 'Suma Total', isFloat: false },
            { minId: 'primosMin', maxId: 'primosMax', absoluteMin: 0, absoluteMax: 6, prefix: 'N√∫meros Primos', isFloat: false },
            { minId: 'sumaDigitosMin', maxId: 'sumaDigitosMax', absoluteMin: 21, absoluteMax: 63, prefix: 'Suma de D√≠gitos', isFloat: false },
            { minId: 'desviacionMin', maxId: 'desviacionMax', absoluteMin: 1.0, absoluteMax: 24.0, prefix: 'Desviaci√≥n', isFloat: true },
        ];

        rangeInputsConfig.forEach(config => {
            const minInput = document.getElementById(config.minId);
            const maxInput = document.getElementById(config.maxId);
            const handler = () => {
                this.validateMinMaxInputs(config.minId, config.maxId, config.absoluteMin, config.absoluteMax, config.prefix, config.isFloat);
                this.updateFilters();
            };
            if(minInput) {
                minInput.addEventListener('change', handler);
                minInput.addEventListener('input', handler);
            }
            if(maxInput) {
                maxInput.addEventListener('change', handler);
                maxInput.addEventListener('input', handler);
            }
        });

        // Botones principales
        document.getElementById('generateBtn').addEventListener('click', () => this.generateCombination());
        document.getElementById('saveBtn').addEventListener('click', () => this.saveTicket());
        document.getElementById('shareBtn').addEventListener('click', () => this.shareTicket());
        document.getElementById('cancelValidationBtn').addEventListener('click', () => this.closeValidationModal());
        document.getElementById('confirmValidationBtn').addEventListener('click', () => this.performValidation());

        // Actualizar estado de papelera
        this.updateClearButtonState();
      }

      // Manejo de clic en n√∫mero
      handleNumberClick(number, ball) {
        // Al hacer clic manual, se eliminan los n√∫meros aleatorios
        this.clearRandomPicks();
        
        if(this.currentSelectionMode === 'excluded') {
          this.toggleExcludedNumber(number, ball);
        } else if(this.currentSelectionMode === 'hot') {
          this.toggleHotNumber(number, ball);
        } else if(this.currentSelectionMode === 'cold') {
          this.toggleColdNumber(number, ball);
        } else {
          // Modo selecci√≥n normal para el propio juego
          this.toggleSelectedNumber(number, ball);
        }
        this.calculateStats();
        this.updateClearButtonState();
      }

      // Toggle de n√∫meros seleccionados
      toggleSelectedNumber(number, ball) {
        const index = this.selectedNumbers.indexOf(number);
        if(index > -1) {
          this.selectedNumbers.splice(index, 1);
          ball.classList.remove('selected');
        } else {
          if(this.selectedNumbers.length < 6) {
            this.selectedNumbers.push(number);
            ball.classList.add('selected');
          }
        }
        this.updateDisplay();
      }

      // Toggle de n√∫meros excluidos
      toggleExcludedNumber(number, ball) {
        if(this.excludedNumbers.has(number)) {
          this.excludedNumbers.delete(number);
          ball.classList.remove('excluded');
        } else {
          this.excludedNumbers.add(number);
          ball.classList.add('excluded');
        }
      }

      // Toggle de n√∫meros calientes
      toggleHotNumber(number, ball) {
        if(this.hotNumbers.has(number)) {
          this.hotNumbers.delete(number);
          ball.classList.remove('hot');
        } else {
          this.hotNumbers.add(number);
          ball.classList.add('hot');
        }
      }

      // Toggle de n√∫meros fr√≠os
      toggleColdNumber(number, ball) {
        if(this.coldNumbers.has(number)) {
          this.coldNumbers.delete(number);
          ball.classList.remove('cold');
        } else {
          this.coldNumbers.add(number);
          ball.classList.add('cold');
        }
      }
      
      // Seleccionar 6 n√∫meros al azar
      selectRandomNumbers() {
        this.clearAllSelections();

        const availableNumbers = Array.from({length: 49}, (_, i) => i + 1);
        const randomPicks = new Set();

        while (randomPicks.size < 6) {
          const randomIndex = Math.floor(Math.random() * availableNumbers.length);
          const number = availableNumbers[randomIndex];
          if (!randomPicks.has(number)) {
            randomPicks.add(number);
          }
        }

        this.selectedNumbers = Array.from(randomPicks);
        this.selectedNumbers.forEach(num => {
          const ball = document.querySelector(`.number-ball[data-number="${num}"]`);
          if (ball) {
            ball.classList.add('random-pick');
          }
        });

        this.updateDisplay();
        this.calculateStats();
        this.updateClearButtonState();
      }
      
      // Limpiar selecciones aleatorias
      clearRandomPicks() {
        document.querySelectorAll('.number-ball.random-pick').forEach(ball => {
          ball.classList.remove('random-pick');
        });
      }
      
      // Limpiar todas las selecciones
      clearAllSelections() {
        this.selectedNumbers = [];
        document.querySelectorAll('.number-ball.selected, .number-ball.random-pick, .number-ball.hot, .number-ball.cold, .number-ball.excluded').forEach(ball => {
          ball.classList.remove('selected', 'random-pick', 'hot', 'cold', 'excluded');
        });
        
        // Limpiar tambi√©n los sets
        this.hotNumbers.clear();
        this.coldNumbers.clear();
        this.excludedNumbers.clear();
        
        this.updateDisplay();
        this.calculateStats();
        this.updateClearButtonState();
      }

      // Actualizar estado visual del bot√≥n papelera
      updateClearButtonState() {
        const clearBtn = document.getElementById('clearBtn');
        const hasSelections = this.selectedNumbers.length > 0 || 
                            this.hotNumbers.size > 0 || 
                            this.coldNumbers.size > 0 || 
                            this.excludedNumbers.size > 0;
        
        if (hasSelections) {
          clearBtn.classList.add('has-selections');
        } else {
          clearBtn.classList.remove('has-selections');
        }
      }

      // Sincronizar n√∫meros seleccionados con la visualizaci√≥n
      syncNumbersToGrid() {
        // Limpiar todas las clases primero
        document.querySelectorAll('.number-ball').forEach(ball => {
          ball.classList.remove('selected', 'random-pick');
        });
        
        // Aplicar las clases correctas
        this.selectedNumbers.forEach(num => {
          const ball = document.querySelector(`.number-ball[data-number="${num}"]`);
          if(ball) {
            ball.classList.add('selected');
          }
        });
      }

      // Manejo de clic en filtro
      handleFilterClick(chip) {
        chip.classList.toggle('active');
        this.updateFilters();
      }

      // Validar rangos min/max
      validateMinMaxInputs(minId, maxId, absoluteMin, absoluteMax, prefix, isFloat = false) {
        const minInput = document.getElementById(minId);
        const maxInput = document.getElementById(maxId);
        if (!minInput || !maxInput) return;

        let minValue = isFloat ? parseFloat(minInput.value) : parseInt(minInput.value, 10);
        let maxValue = isFloat ? parseFloat(maxInput.value) : parseInt(maxInput.value, 10);

        if (isNaN(minValue)) minValue = absoluteMin;
        if (isNaN(maxValue)) maxValue = absoluteMax;

        if (minValue < absoluteMin) {
          minValue = absoluteMin;
          this.showToast(`${prefix}: El m√≠nimo es ${absoluteMin}`, 'warning');
        }
        if (maxValue > absoluteMax) {
          maxValue = absoluteMax;
          this.showToast(`${prefix}: El m√°ximo es ${absoluteMax}`, 'warning');
        }
        if (minValue > maxValue) {
          minValue = maxValue;
          this.showToast(`${prefix}: El m√≠nimo no puede ser mayor que el m√°ximo`, 'warning');
        }

        minInput.value = isFloat ? minValue.toFixed(1) : minValue;
        maxInput.value = isFloat ? maxValue.toFixed(1) : maxValue;
      }

      // Actualizaci√≥n de filtros
      updateFilters() {
        this.filters.sum.min = parseInt(document.getElementById('sumMin').value) || 140;
        this.filters.sum.max = parseInt(document.getElementById('sumMax').value) || 169;
        this.filters.primos.min = parseInt(document.getElementById('primosMin').value) || 2;
        this.filters.primos.max = parseInt(document.getElementById('primosMax').value) || 3;
        this.filters.sumaDigitos.min = parseInt(document.getElementById('sumaDigitosMin').value) || 28;
        this.filters.sumaDigitos.max = parseInt(document.getElementById('sumaDigitosMax').value) || 45;
        this.filters.desviacion.min = parseFloat(document.getElementById('desviacionMin').value) || 12.0;
        this.filters.desviacion.max = parseFloat(document.getElementById('desviacionMax').value) || 18.0;

        this.filters.agrupDecenas = Array.from(document.querySelectorAll('#agrupDecenasOptions .filter-chip.active')).map(chip => chip.dataset.value);
        this.filters.consecutivos = Array.from(document.querySelectorAll('#consecutivosOptions .filter-chip.active')).map(chip => chip.dataset.value);
        this.filters.terminaciones = Array.from(document.querySelectorAll('#terminacionesExcluidasOptions .filter-chip.active')).map(chip => chip.dataset.value);
        this.filters.patrones = Array.from(document.querySelectorAll('#patronesOptions .filter-chip.active')).map(chip => chip.dataset.value);
        this.filters.parImpar = Array.from(document.querySelectorAll('#parImparOptions .filter-chip.active')).map(chip => chip.dataset.value);
        this.filters.bajosAltos = Array.from(document.querySelectorAll('#bajosAltosOptions .filter-chip.active')).map(chip => chip.dataset.value);
      }

      // Actualizaci√≥n de visualizaci√≥n
      updateDisplay() {
        const selectedDisplay = document.getElementById('selectedDisplay');
        selectedDisplay.innerHTML = '';

        if(this.selectedNumbers.length === 0) {
          selectedDisplay.innerHTML = '<div style="color:#666; font-style: italic;">Selecciona hasta 6 n√∫meros</div>';
        } else {
          this.selectedNumbers.sort((a, b) => a - b).forEach(num => {
            const span = document.createElement('span');
            span.style.background = '#6366f1';
            span.style.color = 'white';
            span.style.padding = '8px 12px';
            span.style.borderRadius = '20px';
            span.style.fontWeight = 'bold';
            span.textContent = num;
            selectedDisplay.appendChild(span);
          });
        }
      }

      // Generaci√≥n de combinaci√≥n
      async generateCombination() {
        if(this.isGenerating) return;
        this.isGenerating = true;

        try {
          document.getElementById('saveBtn').disabled = false;
          const strategy = document.querySelector('.strategy-btn.active').dataset.strategy;

          if(strategy === 'simple') {
            await this.generateSimpleCombination();
          } else if(strategy === 'winning') {
            await this.generateWinningCombination();
          } else {
            await this.generateMultipleCombination();
          }
        } catch(error) {
          this.showToast('Error generando combinaci√≥n: ' + error.message, 'error');
        } finally {
          this.isGenerating = false;
        }
      }

      // Generaci√≥n de combinaci√≥n simple
      async generateSimpleCombination() {
        const loadingModal = document.getElementById('loadingModal');
        const attemptsEl = document.getElementById('loadingAttempts');
        let attempts = 0;
        const maxAttempts = 50000;

        attemptsEl.textContent = '0';
        loadingModal.style.display = 'flex';

        while(attempts < maxAttempts) {
          attempts++;
          attemptsEl.textContent = attempts;

          if(attempts % 100 === 0) {
            await this.delay(1);
          }

          const combination = this.createIntelligentCombination();

          if(this.validateCombination(combination)) {
            this.selectedNumbers = combination;
            this.syncNumbersToGrid();
            this.updateDisplay();
            this.calculateStats();
            this.showTicket([combination]);
            this.showToast('üéâ ¬°Combinaci√≥n inteligente encontrada!');
            loadingModal.style.display = 'none';
            return;
          }
        }

        loadingModal.style.display = 'none';
        this.showToast('No se encontr√≥ combinaci√≥n v√°lida. Relaja los filtros.', 'error');
      }

      // Generaci√≥n de combinaci√≥n ganadora
      async generateWinningCombination() {
        const loadingModal = document.getElementById('loadingModal');
        const attemptsEl = document.getElementById('loadingAttempts');
        const loadingText = document.getElementById('loadingText');

        loadingModal.style.display = 'flex';
        attemptsEl.textContent = '0';
        loadingText.textContent = 'Generando combinaciones ganadoras...';

        const generateCount = parseInt(document.getElementById('generateCount').value) || 100;
        const playCount = parseInt(document.getElementById('playCount').value) || 10;

        const validCombinations = [];
        let attempts = 0;

        while(validCombinations.length < generateCount && attempts < 100000) {
          attempts++;
          attemptsEl.textContent = attempts;

          if(attempts % 100 === 0) {
            loadingText.textContent = `Encontradas ${validCombinations.length}/${generateCount} combinaciones...`;
            await this.delay(1);
          }

          const combination = this.createIntelligentCombination();

          if(this.validateCombination(combination)) {
            const combinationStr = combination.join(',');
            if(!validCombinations.some(c => c.join(',') === combinationStr)) {
              validCombinations.push(combination);
            }
          }
        }

        if(validCombinations.length === 0) {
          loadingModal.style.display = 'none';
          this.showToast('No se generaron combinaciones v√°lidas. Relaja los filtros.', 'error');
          return;
        }

        const bestCombinations = this.selectBestCombinations(validCombinations, playCount);

        if(bestCombinations.length > 0) {
          this.selectedNumbers = bestCombinations[0];
          this.syncNumbersToGrid();
          this.updateDisplay();
          this.calculateStats();
        }

        this.showTicket(bestCombinations);
        this.showToast(`üéâ ¬°Generadas ${validCombinations.length} combinaciones! Mostrando las ${playCount} mejores.`);
        loadingModal.style.display = 'none';
      }

      // Generaci√≥n de combinaci√≥n m√∫ltiple
      async generateMultipleCombination() {
        const loadingModal = document.getElementById('loadingModal');
        const attemptsEl = document.getElementById('loadingAttempts');
        const loadingText = document.getElementById('loadingText');

        attemptsEl.textContent = '0';
        loadingModal.style.display = 'flex';
        loadingText.textContent = 'Generando combinaci√≥n m√∫ltiple...';

        const numNumbers = parseInt(document.querySelector('.number-option.active')?.dataset.numbers || 7);
        const maxAttempts = 50000;
        let attempts = 0;

        const getRequiredPercentage = (numbers) => {
          switch(numbers) {
            case 7: return 60;
            case 8: return 40;
            case 9: return 25;
            case 10: return 15;
            case 11: return 10;
            default: return 50;
          }
        };

        const requiredPercentage = getRequiredPercentage(numNumbers);
        let bestCandidate = null;

        loadingText.textContent = `Buscando ${numNumbers} n√∫meros (m√≠nimo ${requiredPercentage}% v√°lidas)...`;

        while(attempts < maxAttempts) {
          attempts++;
          attemptsEl.textContent = attempts;

          if(attempts % 100 === 0) {
            const bestPercent = bestCandidate ? bestCandidate.percentage.toFixed(1) : '0';
            loadingText.textContent = `Intento ${attempts} - Mejor: ${bestPercent}% (necesita ${requiredPercentage}%)`;
            await this.delay(1);
          }

          const nNumbers = this.generateDistributedNumbers(numNumbers);
          const allCombinations = this.generateCombinations(nNumbers, 6);
          let validCombinations = 0;
          for(const combo of allCombinations) {
            if(this.validateCombination(combo)) {
              validCombinations++;
            }
          }

          const validPercentage = (validCombinations / allCombinations.length) * 100;

          if(validPercentage >= requiredPercentage) {
            this.selectedNumbers = nNumbers.slice(0, 6);
            this.syncNumbersToGrid();
            this.updateDisplay();
            this.calculateStats();

            this.showTicketMultiple(nNumbers, validCombinations, allCombinations.length);
            this.showToast(`üéâ ¬°Combinaci√≥n m√∫ltiple de ${numNumbers} n√∫meros encontrada! (${validCombinations}/${allCombinations.length} v√°lidas - ${validPercentage.toFixed(1)}%)`);
            loadingModal.style.display = 'none';
            return;
          }

          if(!bestCandidate || validPercentage > bestCandidate.percentage) {
            bestCandidate = {
              numbers: [...nNumbers],
              validCombinations: validCombinations,
              totalCombinations: allCombinations.length,
              percentage: validPercentage
            };
          }
        }

        if(bestCandidate && bestCandidate.percentage >= requiredPercentage * 0.6) {
          this.selectedNumbers = bestCandidate.numbers.slice(0, 6);
          this.syncNumbersToGrid();
          this.updateDisplay();
          this.calculateStats();

          this.showTicketMultiple(bestCandidate.numbers, bestCandidate.validCombinations, bestCandidate.totalCombinations);
          this.showToast(`‚ö° Mejor combinaci√≥n de ${numNumbers} n√∫meros encontrada (${bestCandidate.validCombinations}/${bestCandidate.totalCombinations} v√°lidas - ${bestCandidate.percentage.toFixed(1)}%)`);
          loadingModal.style.display = 'none';
          return;
        }

        loadingModal.style.display = 'none';
        this.showToast(`No se encontr√≥ combinaci√≥n m√∫ltiple de ${numNumbers} n√∫meros v√°lida. Mejor intento: ${bestCandidate ? bestCandidate.percentage.toFixed(1) : 0}%. Intenta relajar los filtros.`, 'error');
      }

      // Crear combinaci√≥n inteligente (L√ìGICA ORIGINAL CORREGIDA)
      createIntelligentCombination() {
        const combination = [];
        const availableNumbers = Array.from({length: 49}, (_, i) => i + 1)
          .filter(num => !this.excludedNumbers.has(num));
        
        // Incluir algunos n√∫meros calientes seleccionados (m√°ximo 2)
        const hotSelected = Array.from(this.hotNumbers).filter(n => availableNumbers.includes(n));
        if(hotSelected.length > 0) {
          const hotToAdd = Math.min(2, hotSelected.length);
          for(let i = 0; i < hotToAdd; i++) {
            const randomHot = hotSelected[Math.floor(Math.random() * hotSelected.length)];
            if(!combination.includes(randomHot)) {
              combination.push(randomHot);
              hotSelected.splice(hotSelected.indexOf(randomHot), 1);
            }
          }
        }
        
        // Incluir algunos n√∫meros fr√≠os seleccionados (m√°ximo 2)
        const coldSelected = Array.from(this.coldNumbers).filter(n => availableNumbers.includes(n));
        if(coldSelected.length > 0 && combination.length < 6) {
          const coldToAdd = Math.min(2, coldSelected.length, 6 - combination.length);
          for(let i = 0; i < coldToAdd; i++) {
            const randomCold = coldSelected[Math.floor(Math.random() * coldSelected.length)];
            if(!combination.includes(randomCold)) {
              combination.push(randomCold);
              coldSelected.splice(coldSelected.indexOf(randomCold), 1);
            }
          }
        }

        // Completar con n√∫meros aleatorios
        const remainingNumbers = availableNumbers.filter(n => !combination.includes(n));
        while (combination.length < 6 && remainingNumbers.length > 0) {
          const randomIndex = Math.floor(Math.random() * remainingNumbers.length);
          combination.push(remainingNumbers.splice(randomIndex, 1)[0]);
        }

        return combination.slice(0, 6).sort((a, b) => a - b);
      }

      // Generar n√∫meros con mejor distribuci√≥n
      generateDistributedNumbers(count) {
        const availableNumbers = Array.from({length: 49}, (_, i) => i + 1)
          .filter(num => !this.excludedNumbers.has(num));
        const attempts = [];
        for(let i = 0; i < 10; i++) {
          const candidate = [];
          const available = [...availableNumbers];

          const ranges = [
            {min: 1, max: 10, count: 0},
            {min: 11, max: 20, count: 0},
            {min: 21, max: 30, count: 0},
            {min: 31, max: 40, count: 0},
            {min: 41, max: 49, count: 0}
          ];

          const numbersPerRange = Math.floor(count / 5);
          const extraNumbers = count % 5;

          for(let rangeIdx = 0; rangeIdx < ranges.length && candidate.length < count; rangeIdx++) {
            const range = ranges[rangeIdx];
            const targetCount = numbersPerRange + (rangeIdx < extraNumbers ? 1 : 0);
            const rangeNumbers = available.filter(n => n >= range.min && n <= range.max);

            for(let j = 0; j < targetCount && rangeNumbers.length > 0 && candidate.length < count; j++) {
              const randomIndex = Math.floor(Math.random() * rangeNumbers.length);
              const selectedNumber = rangeNumbers.splice(randomIndex, 1)[0];
              candidate.push(selectedNumber);
              available.splice(available.indexOf(selectedNumber), 1);
            }
          }

          while(candidate.length < count && available.length > 0) {
            const randomIndex = Math.floor(Math.random() * available.length);
            candidate.push(available.splice(randomIndex, 1)[0]);
          }

          attempts.push(candidate.sort((a, b) => a - b));
        }

        let bestAttempt = attempts[0];
        let bestScore = this.calculateDistributionScore(bestAttempt);

        for(let i = 1; i < attempts.length; i++) {
          const score = this.calculateDistributionScore(attempts[i]);
          if(score > bestScore) {
            bestScore = score;
            bestAttempt = attempts[i];
          }
        }

        return bestAttempt;
      }

      // Calcular puntuaci√≥n de distribuci√≥n
      calculateDistributionScore(numbers) {
        let score = 0;
        const ranges = [
          {min: 1, max: 10}, {min: 11, max: 20}, {min: 21, max: 30},
          {min: 31, max: 40}, {min: 41, max: 49}
        ];

        ranges.forEach(range => {
          const count = numbers.filter(n => n >= range.min && n <= range.max).length;
          if(count > 0 && count <= 3) score += count * 2;
          if(count > 3) score -= (count - 3);
        });

        for(let i = 1; i < numbers.length; i++) {
          const gap = numbers[i] - numbers[i-1];
          if(gap >= 2 && gap <= 8) score += 1;
          if(gap === 1) score -= 0.5;
          if(gap > 15) score -= 1;
        }

        if(this.hotNumbers && this.hotNumbers.size > 0) {
          const hotCount = numbers.filter(n => this.hotNumbers.has(n)).length;
          score += hotCount * 0.5;
        }

        return score;
      }

      // Generar combinaciones
      generateCombinations(array, size) {
        if(size === 1) return array.map(value => [value]);
        if(size === array.length) return [array];
        if(size > array.length) return [];

        const combinations = [];
        for(let i = 0; i <= array.length - size; i++) {
          const head = array.slice(i, i + 1);
          const tailCombinations = this.generateCombinations(array.slice(i + 1), size - 1);

          for(const tail of tailCombinations) {
            combinations.push([...head, ...tail]);
          }
        }
        return combinations;
      }

      // Selecci√≥n de mejores combinaciones
      selectBestCombinations(combinations, count) {
        return combinations
          .map(combo => ({
            combination: combo,
            score: this.calculateAdvancedCombinationScore(combo)
          }))
          .sort((a, b) => b.score - a.score)
          .slice(0, count)
          .map(item => item.combination);
      }

      // C√°lculo de puntuaci√≥n avanzada
      calculateAdvancedCombinationScore(combination) {
        let score = 0;
        const hotNumbers = combination.filter(n => this.hotNumbers.has(n));
        score += hotNumbers.length * 15;
        const coldNumbers = combination.filter(n => this.coldNumbers.has(n));
        score -= coldNumbers.length * 8;

        combination.forEach(num => {
          const stats = this.numberStats[num];
          if(stats) {
            score += stats.score * 5;
            if(stats.cycle >= 3 && stats.cycle <= 12) score += 3;
            if(stats.trend > 0) score += stats.trend * 4;
          }
        });

        const suma = combination.reduce((a, b) => a + b, 0);
        if(suma >= 140 && suma <= 169) score += 20;
        const pares = combination.filter(n => n % 2 === 0).length;
        if(pares >= 2 && pares <= 4) score += 15;
        const bajos = combination.filter(n => n <= 25).length;
        if(bajos >= 2 && bajos <= 4) score += 10;

        const ranges = [
          combination.filter(n => n >= 1 && n <= 10).length,
          combination.filter(n => n >= 11 && n <= 20).length,
          combination.filter(n => n >= 21 && n <= 30).length,
          combination.filter(n => n >= 31 && n <= 40).length,
          combination.filter(n => n >= 41 && n <= 49).length
        ];
        const nonEmptyRanges = ranges.filter(count => count > 0).length;
        score += nonEmptyRanges * 2;
        score += Math.random() * 3;
        return score;
      }

      // Validaci√≥n de combinaci√≥n
      validateCombination(combination) {
        if (combination.length !== 6) return false;
        if (new Set(combination).size !== 6) return false;
        if (combination.some(n => this.excludedNumbers.has(n))) return false;
        if (this.filters.terminaciones.length > 0) {
          if (combination.some(n => this.filters.terminaciones.includes(String(n % 10)))) {
            return false;
          }
        }

        const suma = combination.reduce((a, b) => a + b, 0);
        if (suma < this.filters.sum.min || suma > this.filters.sum.max) return false;

        const pares = combination.filter(n => n % 2 === 0).length;
        const parImpar = `${pares}/${6 - pares}`;
        if (this.filters.parImpar.length > 0 && !this.filters.parImpar.includes(parImpar)) return false;

        const bajos = combination.filter(n => n <= 25).length;
        const bajosAltos = `${bajos}/${6 - bajos}`;
        if (this.filters.bajosAltos.length > 0 && !this.filters.bajosAltos.includes(bajosAltos)) return false;

        const decenas = {
          '1-9': combination.filter(n => n >= 1 && n <= 9).length,
          '10-19': combination.filter(n => n >= 10 && n <= 19).length,
          '20-29': combination.filter(n => n >= 20 && n <= 29).length,
          '30-39': combination.filter(n => n >= 30 && n <= 39).length,
          '40-49': combination.filter(n => n >= 40 && n <= 49).length
        };
        const decenaCounts = Object.values(decenas).filter(count => count > 0).sort((a, b) => b - a);
        const agrupDecenas = decenaCounts.join('/');
        if (this.filters.agrupDecenas.length > 0 && !this.filters.agrupDecenas.includes(agrupDecenas)) return false;

        if (!this.validateConsecutivePattern(combination)) return false;

        const sumaDigitos = combination.reduce((sum, num) => {
          return sum + num.toString().split('').reduce((digitSum, digit) => digitSum + parseInt(digit), 0);
        }, 0);
        if (sumaDigitos < this.filters.sumaDigitos.min || sumaDigitos > this.filters.sumaDigitos.max) return false;

        const primosList = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47];
        const primos = combination.filter(n => primosList.includes(n)).length;
        if (primos < this.filters.primos.min || primos > this.filters.primos.max) return false;

        const mean = combination.reduce((a, b) => a + b, 0) / 6;
        const variance = combination.reduce((sum, num) => sum + Math.pow(num - mean, 2), 0) / 6;
        const desviacion = Math.sqrt(variance);
        if (desviacion < this.filters.desviacion.min || desviacion > this.filters.desviacion.max) return false;

        if (this.filters.patrones.includes('fibonacci') && this.isFibonacciSequence(combination)) return false;
        if (this.filters.patrones.includes('paresConsecutivos') && this.hasConsecutivePairs(combination)) return false;
        if (this.filters.patrones.includes('multiplos') && this.hasMultiples(combination)) return false;

        return true;
      }

      // Validar patr√≥n de consecutivos
      validateConsecutivePattern(combination) {
        const activePatterns = this.filters.consecutivos;
        if (activePatterns.length === 0) return true;
        const sorted = [...combination].sort((a, b) => a - b);
        const actualPattern = this.calculateConsecutivePattern(sorted);
        return activePatterns.includes(actualPattern);
      }

      // Calcular patr√≥n de consecutivos
      calculateConsecutivePattern(sortedNumbers) {
        if (sortedNumbers.length !== 6) return '-';
        const consecutiveGroups = [];
        let currentGroup = 1;

        for (let i = 1; i < sortedNumbers.length; i++) {
          if (sortedNumbers[i] === sortedNumbers[i-1] + 1) {
            currentGroup++;
          } else {
            if (currentGroup > 1) {
              consecutiveGroups.push(currentGroup);
            }
            currentGroup = 1;
          }
        }

        if (currentGroup > 1) {
          consecutiveGroups.push(currentGroup);
        }

        const totalInGroups = consecutiveGroups.reduce((sum, group) => sum + group, 0);
        const singleNumbers = 6 - totalInGroups;

        const pattern = [...consecutiveGroups];
        for (let i = 0; i < singleNumbers; i++) {
          pattern.push(1);
        }

        return pattern.sort((a, b) => b - a).join('/');
      }

      // Verificaci√≥n de secuencia Fibonacci
      isFibonacciSequence(numbers) {
        const fib = [1, 1, 2, 3, 5, 8, 13, 21, 34];
        return numbers.every(num => fib.includes(num));
      }

      // Verificaci√≥n de pares consecutivos
      hasConsecutivePairs(numbers) {
        const sorted = [...numbers].sort((a, b) => a - b);
        for(let i = 0; i < sorted.length - 1; i++) {
          if(sorted[i+1] === sorted[i] + 1 && sorted[i] % 2 === 0) {
            return true;
          }
        }
        return false;
      }

      // Verificaci√≥n de m√∫ltiplos
      hasMultiples(numbers) {
        for(let i = 0; i < numbers.length; i++) {
          for(let j = i + 1; j < numbers.length; j++) {
            if(numbers[j] % numbers[i] === 0 || numbers[i] % numbers[j] === 0) {
              return true;
            }
          }
        }
        return false;
      }

      // C√°lculo de estad√≠sticas
      calculateStats() {
        if (this.selectedNumbers.length < 6) {
          this.clearStats();
          return;
        }

        const nums = [...this.selectedNumbers].sort((a, b) => a - b);

        // Suma
        const suma = nums.reduce((a, b) => a + b, 0);
        const sumaValid = suma >= this.filters.sum.min && suma <= this.filters.sum.max;
        this.updateStat('suma', suma, sumaValid);

        // Par/Impar
        const pares = nums.filter(n => n % 2 === 0).length;
        const impares = nums.length - pares;
        const parImpar = `${pares}/${impares}`;
        const parImparValid = this.filters.parImpar.includes(parImpar);
        this.updateStat('parImpar', parImpar, parImparValid);

        // Bajos/Altos
        const bajos = nums.filter(n => n <= 25).length;
        const altos = nums.length - bajos;
        const bajosAltos = `${bajos}/${altos}`;
        const bajosAltosValid = this.filters.bajosAltos.includes(bajosAltos);
        this.updateStat('bajosAltos', bajosAltos, bajosAltosValid);

        // Decenas individuales
        const decenasCount = {
          '1-9': nums.filter(n => n >= 1 && n <= 9).length,
          '10-19': nums.filter(n => n >= 10 && n <= 19).length,
          '20-29': nums.filter(n => n >= 20 && n <= 29).length,
          '30-39': nums.filter(n => n >= 30 && n <= 39).length,
          '40-49': nums.filter(n => n >= 40 && n <= 49).length
        };
        const decenasPresentes = Object.keys(decenasCount).filter(k => decenasCount[k] > 0);
        this.updateStat('decenas', decenasPresentes.length, true);

        // Agrupaci√≥n por decenas
        const decenaCounts = Object.values(decenasCount).filter(count => count > 0).sort((a, b) => b - a);
        const agrupDecenas = decenaCounts.join('/');
        const agrupDecenasValid = this.filters.agrupDecenas.includes(agrupDecenas);
        this.updateStat('agrupDecenas', agrupDecenas, agrupDecenasValid);

        // Consecutivos
        this.calculateConsecutiveStats(nums);

        // Suma de d√≠gitos
        const sumaDigitos = nums.reduce((sum, num) => {
          return sum + num.toString().split('').reduce((digitSum, digit) => digitSum + parseInt(digit), 0);
        }, 0);
        const sumaDigitosValid = sumaDigitos >= this.filters.sumaDigitos.min && sumaDigitos <= this.filters.sumaDigitos.max;
        this.updateStat('sumaDigitos', sumaDigitos, sumaDigitosValid);

        // Primos
        const primosList = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47];
        const primos = nums.filter(n => primosList.includes(n)).length;
        const primosValid = primos >= this.filters.primos.min && primos <= this.filters.primos.max;
        this.updateStat('primos', primos, primosValid);

        // Desviaci√≥n est√°ndar
        if (nums.length >= 2) {
          const mean = suma / nums.length;
          const variance = nums.reduce((sum, num) => sum + Math.pow(num - mean, 2), 0) / nums.length;
          const desviacion = Math.sqrt(variance);
          const desviacionValid = desviacion >= this.filters.desviacion.min && desviacion <= this.filters.desviacion.max;
          this.updateStat('desviacion', desviacion.toFixed(2), desviacionValid);
        } else {
          this.updateStat('desviacion', '-', false);
        }

        // Patrones
        let patrones = [];
        if (this.isFibonacciSequence(nums)) patrones.push('Fibonacci');
        if (this.hasConsecutivePairs(nums)) patrones.push('Pares consec.');
        if (this.hasMultiples(nums)) patrones.push('M√∫ltiplos');

        const patronesText = patrones.length > 0 ? patrones.join(', ') : 'Ninguno';
        this.updateStat('patrones', patronesText, true);
      }

      // Calcular estad√≠sticas de consecutivos
      calculateConsecutiveStats(nums) {
        const sorted = [...nums].sort((a, b) => a - b);
        const consecutivePattern = this.calculateConsecutivePattern(sorted);
        const consecutivosValid = this.validateConsecutivePattern(nums);

        this.updateStat('consecutivos', consecutivePattern, consecutivosValid);

        return { pattern: consecutivePattern, valid: consecutivosValid };
      }

      // Limpiar estad√≠sticas
      clearStats() {
        const statIds = ['statSuma', 'statParImpar', 'statBajosAltos', 'statDecenas', 'statAgrupDecenas', 'statConsecutivos', 'statSumaDigitos', 'statPrimos', 'statDesviacion', 'statPatrones'];
        statIds.forEach(id => {
          const element = document.getElementById(id);
          if(element) {
            element.textContent = '-';
            element.className = 'stat-value';
          }
        });
      }

      // Actualizar estad√≠stica individual
      updateStat(statName, value, isValid) {
        const element = document.getElementById(`stat${statName.charAt(0).toUpperCase() + statName.slice(1)}`);
        if(element) {
          element.textContent = value;
          element.className = `stat-value ${isValid ? 'valid' : 'invalid'}`;
        }
      }

      // Mostrar boleto
      showTicket(combinations) {
        const ticketEl = document.getElementById('ticket');
        const ticketCombinations = document.getElementById('ticketCombinations');
        ticketCombinations.innerHTML = combinations.map((combo, index) => `
          <div class="ticket-combination">
            <div class="ticket-number">${index + 1}</div>
            <div>${combo.join('-')}</div>
          </div>
        `).join('');

        const now = new Date();
        document.getElementById('ticketDate').textContent = now.toLocaleString('es-ES');
        ticketEl.style.display = 'block';

        this.currentTicket = {
          combinations: combinations,
          date: now.toISOString(),
          id: Date.now(),
          maxHits: null
        };
      }

      // Mostrar boleto m√∫ltiple
      showTicketMultiple(numbers, validCombinations, totalCombinations) {
        const ticketEl = document.getElementById('ticket');
        const ticketCombinations = document.getElementById('ticketCombinations');
        ticketCombinations.innerHTML = `
          <div class="ticket-combination">
            <div class="ticket-number">1</div>
            <div>${numbers.join('-')}</div>
          </div>
          <div style="padding: 10px; background:#f9fafb; border-radius: 6px; font-size: 0.9rem;">
            ${validCombinations}/${totalCombinations} combinaciones v√°lidas (${((validCombinations/totalCombinations)*100).toFixed(1)}%)
          </div>
        `;

        const now = new Date();
        document.getElementById('ticketDate').textContent = now.toLocaleString('es-ES');
        ticketEl.style.display = 'block';

        this.currentTicket = {
          combinations: [numbers],
          date: now.toISOString(),
          id: Date.now(),
          maxHits: null
        };
      }

      // Guardar boleto
      saveTicket() {
        if(!this.currentTicket) {
          this.showToast('No hay boleto para guardar', 'error');
          return;
        }

        // L√≠mite de 10 boletos
        if (this.savedTickets.length >= 10) {
            this.savedTickets.pop();
        }
        this.savedTickets.unshift(this.currentTicket);
        this.saveToStorage();
        this.updateSavedTickets();
        this.showToast('Boleto guardado correctamente');
        document.getElementById('saveBtn').disabled = true;
      }

      // Compartir boleto
      shareTicket() {
        if(!this.currentTicket) {
          this.showToast('No hay boleto para compartir', 'error');
          return;
        }

        const shareText = `üé≤ DataLotto 49 PRO - An√°lisis IA
üìÖ ${new Date(this.currentTicket.date).toLocaleString('es-ES')}
${this.currentTicket.combinations.map((combo, index) => `${index + 1}. ${combo.join('-')}`).join('\n')}
¬°Combinaci√≥n generada con IA! ü§ñüçÄ`;

        if(navigator.share) {
          navigator.share({ title: 'DataLotto 49 PRO - An√°lisis IA', text: shareText });
        } else {
          navigator.clipboard.writeText(shareText).then(() => {
            this.showToast('Boleto copiado al portapapeles');
          }).catch(() => {
            this.showToast('Error al copiar el boleto', 'error');
          });
        }
      }

      // Actualizar boletos guardados
      updateSavedTickets() {
        const container = document.getElementById('savedTickets');
        if(this.savedTickets.length === 0) {
          container.innerHTML = '<div style="color:#666; text-align: center; padding: 20px;">No tienes boletos guardados</div>';
          return;
        }

        container.innerHTML = this.savedTickets.map(ticket => `
          <div class="saved-ticket-item" data-ticket-id="${ticket.id}">
            <div class="saved-ticket-header">
              <div class="saved-ticket-date">
                Boleto #${ticket.id.toString().slice(-4)} | ${new Date(ticket.date).toLocaleString('es-ES')}
                ${ticket.maxHits !== null ? `<span style="color: var(--success); font-weight: bold;"> | M√°x: ${ticket.maxHits} aciertos</span>` : ''}
              </div>
              <div class="saved-ticket-actions">
                <button class="saved-ticket-btn validate" data-id="${ticket.id}">üîç Validar</button>
              </div>
            </div>
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <span>${ticket.combinations.length} combinaci√≥n${ticket.combinations.length > 1 ? 'es' : ''}</span>
              <button class="toggle-btn" data-id="${ticket.id}"><span>+</span></button>
            </div>
            <div class="saved-combinations" data-id="${ticket.id}" style="display: none;">
              ${ticket.combinations.map((combo, index) => `
                <div class="saved-combination" data-combo-index="${index}">
                  <div class="saved-combination-content">
                    <div class="saved-combination-number">${index + 1}</div>
                    <div style="font-family:'Courier New', monospace;">${combo.join('-')}</div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `).join('');

        document.querySelectorAll('.toggle-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const btnEl = e.target.closest('.toggle-btn');
            const ticketId = btnEl.dataset.id;
            const combinations = document.querySelector(`.saved-combinations[data-id="${ticketId}"]`);
            const isVisible = combinations.style.display === 'block';
            combinations.style.display = isVisible ? 'none' : 'block';
            btnEl.innerHTML = isVisible ? '<span>+</span>' : '<span>‚àí</span>';
          });
        });

        document.querySelectorAll('.validate').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const ticketId = e.target.dataset.id;
            this.validateSavedTicket(ticketId);
          });
        });
      }

      // Validar boleto guardado
      validateSavedTicket(ticketId) {
        const ticket = this.savedTickets.find(t => t.id.toString() === ticketId);
        if(!ticket) {
          this.showToast('Boleto no encontrado', 'error');
          return;
        }

        this.currentValidatingTicket = ticket;
        this.showValidationModal();
      }

      // Mostrar modal de validaci√≥n
      showValidationModal() {
        document.getElementById('validationModal').style.display = 'flex';
        document.getElementById('winningNumbersInput').value = '';
        document.getElementById('validationResults').innerHTML = '';
      }

      // Cerrar modal de validaci√≥n
      closeValidationModal() {
        document.getElementById('validationModal').style.display = 'none';
        this.currentValidatingTicket = null;
      }

      // Realizar validaci√≥n
      performValidation() {
        if(!this.currentValidatingTicket) {
          this.showToast('No hay boleto para validar', 'error');
          return;
        }

        const input = document.getElementById('winningNumbersInput').value.trim();
        if(!input) {
          this.showToast('Por favor, introduce los n√∫meros ganadores', 'error');
          return;
        }

        // Permitir separaci√≥n por espacios, comas o puntos
        const winningNumbers = input.split(/[,\s\.]+/).map(n => parseInt(n.trim())).filter(n => !isNaN(n) && n >= 1 && n <= 49);
        if(winningNumbers.length !== 6) {
          this.showToast('Debes introducir exactamente 6 n√∫meros ganadores v√°lidos.', 'error');
          return;
        }

        let resultsHtml = '<h4>Resultados de Validaci√≥n</h4>';
        let maxMatches = 0;

        // Actualizar el DOM del boleto guardado con los aciertos
        const ticketElement = document.querySelector(`.saved-ticket-item[data-ticket-id="${this.currentValidatingTicket.id}"]`);

        this.currentValidatingTicket.combinations.forEach((combo, index) => {
          const matches = combo.filter(num => winningNumbers.includes(num)).length;
          if (matches > maxMatches) maxMatches = matches;
          
          resultsHtml += `<div style="margin: 10px 0; padding: 10px; background:#f9fafb; border-radius: 6px;">
              <strong>Combinaci√≥n ${index + 1}:</strong> ${combo.join('-')}<br>
              <strong>Aciertos: ${matches}/6</strong>
            </div>`;

          if (ticketElement) {
             const comboElement = ticketElement.querySelector(`.saved-combination[data-combo-index="${index}"]`);
             if (comboElement) {
                // Limpiar aciertos previos
                const existingHitCount = comboElement.querySelector('.hit-count');
                if (existingHitCount) existingHitCount.remove();
                // A√±adir nuevo
                const hitCountSpan = document.createElement('span');
                hitCountSpan.className = 'hit-count';
                hitCountSpan.textContent = `${matches} aciertos`;
                comboElement.appendChild(hitCountSpan);
             }
          }
        });

        resultsHtml += `<div style="margin-top: 10px; padding: 10px; background:#e0f2fe; border-radius: 6px; font-weight: bold;">
          M√°ximo de aciertos en una combinaci√≥n: ${maxMatches}/6
        </div>`;

        // Guardar aciertos m√°ximos en el boleto (persistencia)
        this.currentValidatingTicket.maxHits = maxMatches;
        this.saveToStorage();
        this.updateSavedTickets();

        document.getElementById('validationResults').innerHTML = resultsHtml;
        this.showToast('Validaci√≥n completada.');
      }

      // Cargar boletos guardados
      loadSavedTickets() {
        try {
          const saved = localStorage.getItem('DataLotto49AdvancedTickets');
          if(saved) {
            this.savedTickets = JSON.parse(saved);
            this.updateSavedTickets();
          }
        } catch(error) {
          console.error('Error loading saved tickets:', error);
        }
      }

      // Guardar en almacenamiento
      saveToStorage() {
        try {
          localStorage.setItem('DataLotto49AdvancedTickets', JSON.stringify(this.savedTickets));
        } catch(error) {
          console.error('Error saving tickets:', error);
          this.showToast('Error al guardar el boleto', 'error');
        }
      }

      // Mostrar mensaje
      showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast ${type}`;
        toast.classList.add('show');

        setTimeout(() => {
          toast.classList.remove('show');
        }, 3500);
      }

      // Retardo
      delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
    }

    // Inicializaci√≥n de la aplicaci√≥n
    let app;
    document.addEventListener('DOMContentLoaded', () => {
      try {
        app = new DataLotto49Advanced();
        console.log('‚úÖ DataLotto 49 Advanced cargado exitosamente');
      } catch(error) {
        console.error('‚ùå Error al cargar DataLotto 49 Advanced:', error);
      }
    });
  </script>
</body>
</html>
